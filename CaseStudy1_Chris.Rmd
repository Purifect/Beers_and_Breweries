---
title: "Case Study 1"
output: html_document
---


```{r}
library(tidyverse)
library(ggthemes)
```


############
# Read in the data from csv
```{r}
beerDataOrig = read.csv(file.choose(),header = TRUE)
breweryDataOrig = rread.csv(file.choose(),header = TRUE)

# Set style and state to be factors
beerDataOrig$Style <- factor(beerDataOrig$Style)
breweryDataOrig$State <- factor(breweryDataOrig$State)

# clean the data (remove observations with missing data)
#     may want to revisit this if we don't use all columns
beerData = beerDataOrig %>% filter(!is.na(Name) & !is.na(Beer_ID) & !is.na(ABV) & 
                                   !is.na(IBU) & !is.na(Brewery_id) & !is.na(Style) & 
                                   !is.na(Ounces))

breweryData = breweryDataOrig %>% filter(!is.na(Brew_ID) & !is.na(Name) & 
                                         !is.na(City) & !is.na(State))

head(beerData)
head(breweryData)
```


############
# 1. How many breweries are present in each state?
```{r}
# print counts
stateCount = breweryData %>% group_by(State) %>% summarize(count=n())
stateCount

# Bar Plot - set y to be State so text fits better
breweryData %>% ggplot(aes(y = State)) + geom_bar() + ggtitle("Breweries by State") + xlab("State") + ylab("Number of Breweries")
```


############
# 2. Merge beer data with the breweries data. Print the first 6 observations 
#    and the last six observations to check the merged file.  (RMD only, this 
#    does not need to be included in the presentation or the deck.)
```{r}
# inner join. Note: the data sets have slightly different column names for Brewery ID
mergedBeerData = merge(beerData, breweryData, by.x="Brewery_id", by.y="Brew_ID")
mergedBeerData = mergedBeerData %>% rename(Beer_name=Name.x, Brewery_name=Name.y)

head(mergedBeerData)
tail(mergedBeerData)

```


############
# 3. Address the missing values in each column.
```{r}
# done in the first markdown chunk right after reading in the data

```


############
# 4. Compute the median alcohol content and IBU for each state. Plot a bar 
#    chart to compare.
```{r}
# Print ABV by State results
medianAbvState = mergedBeerData %>% group_by(State) %>% summarize(median=median(ABV))
medianAbvState

# Bar Plot - set y to be State so text fits better
mergedBeerData %>% ggplot(aes(x=ABV, y=State)) + geom_bar(stat = "summary", fun.y = "median") + ggtitle("ABV by State") + xlab("State") + ylab("Alcohol Content")

# Print IBU by State results
medianIbuState = mergedBeerData %>% group_by(State) %>% summarize(median=median(IBU))
medianIbuState

# Bar Plot - set y to be State so text fits better
mergedBeerData %>% ggplot(aes(x=IBU, y=State)) + geom_bar(stat = "summary", fun.y = "median") + ggtitle("IBU by State") + xlab("State") + ylab("Bitterness")

```


############
# 5. Which state has the maximum alcoholic (ABV) beer? Which state has the 
#    most bitter (IBU) beer?
#### Question: is DC ok to consider a state? ####
```{r}
# arrange by ABV in descending order, print state for first observation
orderedABV <- mergedBeerData %>% arrange(desc(ABV))
orderedABV[1,]$State

# arrange by ABV in descending order, print state for first observation
orderedIBU <- mergedBeerData %>% arrange(desc(IBU))
orderedIBU[1,]$State

```


############
# 6. Comment on the summary statistics and distribution of the ABV variable.
#### Question: ABV in general or by State? ####
```{r}
mergedBeerData %>%
    summarize(mean=mean(ABV), 
              sd=sd(ABV), 
              median=median(ABV), 
              range=max(ABV)-min(ABV), 
              min(ABV), 
              max(ABV), 
              IQR=IQR(ABV))
```


############
# 7. Is there an apparent relationship between the bitterness of the beer 
#    and its alcoholic content? Draw a scatter plot.  Make your best judgment 
#    of a relationship and EXPLAIN your answer.
```{r}
mergedBeerData %>% ggplot(aes(x = ABV,y = IBU)) + geom_point() + ggtitle("ABV v. IBU") + geom_smooth(method="lm", se=F)
```


############
# 8. Budweiser would also like to investigate the difference with respect 
#    to IBU and ABV between IPAs (India Pale Ales) and other types of Ale 
#    (any beer with “Ale” in its name other than IPA).  You decide to use 
#    KNN classification to investigate this relationship.  Provide statistical 
#    evidence one way or the other. You can of course assume your audience is 
#    comfortable with percentages … KNN is very easy to understand conceptually.
```{r}
# Create a new column called 'Ale' that can be 'IPA', 'Ale', or 'Other'

### TODO Working through the right regex to make sure IPA and India Pale Ale aren't 
###    counted as both IPAs and Ales

### TODO For this problem, we can filter out the 'Other' from the column since we only
###    need to compare IPA and non-IPA ales

aleBeerFiltered

set.seed(4)
splitPerc = .7

trainIndices = sample(1:dim(aleBeerFiltered)[1], round(splitPerc * dim(aleBeerFiltered)[1]))
beerTrain = aleBeerFiltered[trainIndices,]
beerTest = aleBeerFiltered[-trainIndices,]

# run knn
classifications = knn(beerTrain[,4:5], beerTest[,4:5], beerTrain$Ale, k = 5, prob = TRUE)
summary(classifications)

# Confusion Matrix
table(beerTest$Ale, classifications)
CM =confusionMatrix(table(beerTest$Ale, classifications))
CM
```


# end
